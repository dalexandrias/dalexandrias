- script: |
        cp -r out/plugin-react-0.0.0.xml out_build/plugin-cerca-eletronica-$(NEW_VERSION).xml
        cp -r out/plugin-react-0.0.0.zip out_build/plugin-cerca-eletronica-$(NEW_VERSION).zip
        # Atualizar o campo "version" no package.json usando sed
        sed -i 's/"version": "[^"]*"/"version": "$(NEW_VERSION)"/' package.json
        echo "Arquivos atualizados para a versao: $NEW_VERSION"
        echo "plugin-cerca-eletronica-$(NEW_VERSION).xml"
        echo "plugin-cerca-eletronica-$(NEW_VERSION).zip"
      displayName: 'Atualizar arquivo com nova versão'
      continueOnError: false


- script: |
        # Pega o arquivo mais recente ordenando corretamente as versões
        LATEST_FILE=$(ls -1v out_build/plugin-cerca-eletronica-*.xml 2>/dev/null | tail -n 1)
        if [ -f "$LATEST_FILE" ]; then
          # Usando uma expressão regular para pegar a versão
          CURRENT_VERSION=$(echo "$LATEST_FILE" | sed -E 's/.*plugin-cerca-eletronica-([0-9]+\.[0-9]+\.[0-9]+)\.xml/\1/')
        else
          CURRENT_VERSION="1.0.0"
        fi
        echo "Versão atual detectada: $CURRENT_VERSION"
        echo "##vso[task.setvariable variable=CURRENT_VERSION]$CURRENT_VERSION"
      displayName: 'Obter versao atual'
      continueOnError: false
